<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Card√°pio Online - Categoria + Carrinho Mobile</title>

  <!-- Bootstrap 5 & Icons & SweetAlert -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">

  <style>
    body { background:#f8f9fa; padding-bottom:90px; }

    /* Header */
    header { background:#ffb400; padding:10px 16px; position:sticky; top:0; z-index:800; }
    .navbar-brand{ color:#fff; font-weight:700; }
    .search-desktop { display:block; max-width:420px; }
    @media (max-width:768px){ .search-desktop{ display:none !important; } }

    /* Mobile search section */
    #search-section { display:none; background:#fff; padding:8px; border-bottom:1px solid #e9e9e9; position:sticky; top:56px; z-index:790; }
    @media (max-width:768px){ #search-section{ display:block; } }

    /* Category title */
    .categoria-titulo { margin-top:18px; font-weight:700; padding-left:10px; border-left:5px solid #ffb400; }

    /* Product cards small (mobile first) */
    .card-produto { border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.06); border:none; }
    .card-produto img { height:110px; object-fit:cover; border-radius:10px 10px 0 0; }
    .card-body { padding:8px; }

    /* Carrinho lateral (desktop) */
    .carrinho {
      position:fixed; top:0; right:-420px; width:380px; height:100%; background:#fff; box-shadow:-6px 0 20px rgba(0,0,0,0.12);
      transition:right .36s ease; z-index:1200; overflow:auto; padding:18px;
    }
    .carrinho.ativo { right:0; }

    /* Carrinho modal-style for small screens (use slide-up panel) */
    .carrinho-mobile {
      position:fixed; right:0; bottom:0; left:0; height:60%; max-height:520px; background:#fff; box-shadow:0 -8px 30px rgba(0,0,0,0.2);
      transform: translateY(110%); transition: transform .28s ease; z-index:1300; border-top-left-radius:12px; border-top-right-radius:12px; padding:12px;
    }
    .carrinho-mobile.ativo { transform: translateY(0); }

    /* Floating mobile cart icon */
    #cart-floating {
      display:none;
    }
    @media (max-width:768px){
      #cart-floating {
        display:flex; position:fixed; right:18px; bottom:82px; z-index:1400; background:#ffb400;
        border-radius:50%; width:56px; height:56px; align-items:center; justify-content:center; box-shadow:0 6px 18px rgba(0,0,0,0.25); cursor:pointer;
      }
      #cart-floating .cart-count { position:absolute; top:-6px; right:-6px; }
      /* Hide desktop carrinho element on mobile to show mobile-version instead */
      .carrinho { display:none; }
    }

    /* Buttons inside cart */
    .qty-btn { width:32px; height:32px; border-radius:6px; border:none; display:inline-flex; align-items:center; justify-content:center; }
    .add-more { margin-top:8px; }

    /* Floating red footer-like action button */
    #btn-floating-action {
      position:fixed; right:16px; bottom:16px; z-index:1500; background:#d93636; color:#fff; border:none; padding:14px 18px; border-radius:10px; box-shadow:0 8px 24px rgba(0,0,0,0.25);
      font-weight:700; display:flex; gap:8px; align-items:center; cursor:pointer;
    }
    /* hide when user scrolled to bottom (we'll control via JS) */
    #btn-floating-action.hidden { display:none !important; }

    /* Suggestion chips below search */
    .chip { display:inline-block; background:#fff; border:1px solid #eee; padding:6px 10px; border-radius:20px; margin:4px; cursor:pointer; }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header>
    <nav class="navbar navbar-expand">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">üçî Card√°pio</a>

        <!-- Search (desktop) -->
        <form class="d-flex ms-auto me-3 search-desktop" onsubmit="event.preventDefault(); searchTrigger();">
          <input id="search-input-desktop" class="form-control me-2" placeholder="Pesquisar (ex: bebidas, combos, hamburguer)" />
          <button class="btn btn-dark" type="button" onclick="searchTrigger()">Pesquisar</button>
        </form>

        <!-- Desktop cart icon (hidden in mobile) -->
        <div id="cart-icon-desktop" class="d-none d-md-flex align-items-center" style="gap:10px; color:#fff; margin-left:8px;">
          <i class="bi bi-cart-fill" style="font-size:1.35rem; color:#fff; cursor:pointer;" onclick="toggleCart()"></i>
          <span id="cart-count" class="cart-count badge rounded-pill bg-danger">0</span>
        </div>
      </div>
    </nav>
  </header>

  <!-- Mobile Search Section (stays under header) -->
  <section id="search-section">
    <div class="container-fluid">
      <div class="input-group">
        <input id="search-input-mobile" class="form-control" placeholder="Pesquisar (ex: bebidas, combos, hamburguer)">
        <button class="btn btn-dark" id="btn-search-mobile" type="button" onclick="searchTrigger()">Pesquisar</button>
      </div>
      <!-- Suggestions area (categories) -->
      <div id="search-suggestions" class="mt-2"></div>
    </div>
  </section>

  <!-- MAIN CONTENT (categories + produtos) -->
  <main class="container my-3">
    <!-- Filter controls -->
    <div class="d-flex gap-2 mb-2 align-items-center">
      <button class="btn btn-outline-secondary btn-sm" onclick="showAll()">Mostrar todos</button>
      <button class="btn btn-outline-secondary btn-sm" onclick="loadCategory('lanches')">Lanches</button>
      <button class="btn btn-outline-secondary btn-sm" onclick="loadCategory('bebidas')">Bebidas</button>
      <button class="btn btn-outline-secondary btn-sm" onclick="loadCategory('combos')">Combos</button>
      <button class="btn btn-outline-secondary btn-sm" onclick="loadCategory('ofertas')">Ofertas</button>
    </div>

    <!-- Sections -->
    <h5 class="categoria-titulo" id="title-lanches">üçî Lanches</h5>
    <div class="row" id="lanches"></div>

    <h5 class="categoria-titulo" id="title-bebidas">ü•§ Bebidas</h5>
    <div class="row" id="bebidas"></div>

    <h5 class="categoria-titulo" id="title-combos">üçü Combos</h5>
    <div class="row" id="combos"></div>

    <h5 class="categoria-titulo" id="title-ofertas">üî• Ofertas</h5>
    <div class="row" id="ofertas"></div>
  </main>

  <!-- Desktop Carrinho lateral -->
  <aside class="carrinho" id="carrinho-desktop" aria-hidden="true">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h5 class="m-0">üõí Seu Carrinho</h5>
      <button class="btn btn-sm btn-outline-secondary" onclick="toggleCart()">X</button>
    </div>
    <div id="carrinho-conteudo-desktop"></div>
    <hr>
    <div class="d-flex justify-content-between">
      <strong>Total:</strong><strong id="total-compra-desktop">R$ 0,00</strong>
    </div>
    <div class="mt-3">
      <button class="btn btn-danger w-100 mb-2" onclick="openCheckoutForm()">Finalizar Pedido</button>
      <button class="btn btn-secondary w-100 add-more" onclick="fecharCarrinho()">Adicionar mais itens</button>
    </div>
  </aside>

  <!-- Mobile Carrinho slide-up -->
  <div id="cart-floating" title="Abrir carrinho">
    <i class="bi bi-cart-fill" style="font-size:1.5rem; color:#fff;"></i>
    <span id="cart-count-mobile" class="cart-count badge bg-danger">0</span>
  </div>

  <div class="carrinho-mobile" id="carrinho-mobile-panel" aria-hidden="true">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h6 class="m-0">üõí Carrinho</h6>
      <button class="btn btn-sm btn-outline-secondary" onclick="toggleCartMobile()">X</button>
    </div>
    <div id="carrinho-conteudo-mobile" style="overflow:auto; max-height:60%;"></div>
    <hr>
    <div class="d-flex justify-content-between align-items-center">
      <strong>Total:</strong>
      <strong id="total-compra-mobile">R$ 0,00</strong>
    </div>
    <div class="mt-2">
      <button class="btn btn-danger w-100 mb-2" onclick="openCheckoutForm()">Finalizar Pedido</button>
      <button class="btn btn-secondary w-100" onclick="toggleCartMobile()">Adicionar mais itens</button>
    </div>
  </div>

  <!-- Floating action red button (opens address/payment form) -->
  <button id="btn-floating-action" title="Fazer Pedido">
    <i class="bi bi-credit-card-2-front-fill"></i> Fazer Pedido
  </button>

  <!-- Modal for address/payment (bootstrap) -->
  <div class="modal fade" id="checkoutModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Dados de Entrega e Pagamento</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <div id="checkout-errors" class="text-danger small mb-2" style="display:none"></div>
          <input id="cliente-nome" class="form-control mb-2" placeholder="Nome completo">
          <input id="cliente-endereco" class="form-control mb-2" placeholder="Endere√ßo completo (rua, n√∫mero, complemento)">
          <select id="cliente-pagamento" class="form-select mb-2">
            <option value="">Forma de pagamento</option>
            <option value="Dinheiro">Dinheiro</option>
            <option value="Pix">Pix</option>
            <option value="Cart√£o">Cart√£o</option>
          </select>
          <textarea id="cliente-obs" class="form-control" placeholder="Observa√ß√µes (opcional)"></textarea>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button class="btn btn-success" onclick="sendOrder()">Enviar Pedido (WhatsApp)</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>

  <script>
/* ===========================
   Dados iniciais (produtos)
   =========================== */
const categorias = {
  lanches: [
    { nome: "X-Tudo", preco: 25.99, img: "imagens/xtudo.jpg" },
    { nome: "X-Bacon", preco: 27.50, img: "imagens/xtudo.jpg" },
    { nome: "Hamburguer Artesanal", preco: 29.90, img: "imagens/xtudo.jpg" }
  ],
  bebidas: [
    { nome: "Coca-Cola Lata", preco: 6.00, img: "imagens/coca.jpg" },
    { nome: "Guaran√° Lata", preco: 5.50, img: "imagens/guarana.jpg" },
    { nome: "Suco Natural", preco: 8.00, img: "imagens/suco.jpg" }
  ],
  combos: [
    { nome: "Combo Fam√≠lia", preco: 59.99, img: "imagens/combo.jpg" },
    { nome: "Combo Duplo", preco: 39.99, img: "imagens/combo.jpg" }
  ],
  ofertas: [
    { nome: "X-Tudo + Refri", preco: 29.99, img: "imagens/combo.jpg" },
    { nome: "2x X-Bacon", preco: 49.99, img: "imagens/xtudo.webp" }
  ]
};

let carrinho = JSON.parse(localStorage.getItem("carrinho_v1")) || [];

/* ===========================
   Renderiza√ß√£o de produtos
   =========================== */
function renderAll() {
  renderCategory('lanches','lanches');
  renderCategory('bebidas','bebidas');
  renderCategory('combos','combos');
  renderCategory('ofertas','ofertas');
  updateCartUI();
}

function renderCategory(cat, containerId) {
  const container = document.getElementById(containerId);
  container.innerHTML = '';
  categorias[cat].forEach((p, i) => {
    const idx = i;
    const col = document.createElement('div');
    col.className = 'col-6 col-sm-4 col-md-3 mb-3 produto';
    col.setAttribute('data-nome', p.nome.toLowerCase());
    col.setAttribute('data-cat', cat);
    col.innerHTML = `
      <div class="card card-produto h-100">
        <img src="${p.img}" class="card-img-top" alt="${p.nome}">
        <div class="card-body text-center">
          <h6 class="mb-1">${p.nome}</h6>
          <div class="small text-success fw-bold mb-2">R$ ${p.preco.toFixed(2)}</div>
          <div class="d-flex gap-2">
            <input type="number" min="1" value="1" class="form-control form-control-sm" style="width:80px" id="${containerId}-qtd-${idx}">
            <button class="btn btn-sm btn-comprar" onclick="addToCart('${cat}', ${idx}, '${containerId}-qtd-${idx}')">Comprar</button>
          </div>
        </div>
      </div>`;
    container.appendChild(col);
  });
}

/* ===========================
   Carrinho: adicionar/remover/ajustar
   =========================== */
function addToCart(cat, index, inputId) {
  const produto = categorias[cat][index];
  const qtdInput = document.getElementById(inputId);
  const qtd = Math.max(1, parseInt(qtdInput.value) || 1);
  const existente = carrinho.find(p=>p.nome===produto.nome);
  if (existente) existente.qtd += qtd;
  else carrinho.push({ nome: produto.nome, preco: produto.preco, qtd: qtd });

  saveCart();
  updateCartUI();
  swal("Adicionado!", `${qtd}x ${produto.nome} no carrinho.`, "success");
}

function changeQtyCart(idx, delta) {
  if (!carrinho[idx]) return;
  carrinho[idx].qtd += delta;
  if (carrinho[idx].qtd < 1) carrinho.splice(idx,1);
  saveCart();
  updateCartUI();
}

function removeItemCart(idx) {
  carrinho.splice(idx,1);
  saveCart();
  updateCartUI();
}

function saveCart() {
  localStorage.setItem("carrinho_v1", JSON.stringify(carrinho));
}

/* ===========================
   Atualizar UI do Carrinho
   =========================== */
function updateCartUI() {
  // totals
  const total = carrinho.reduce((acc,p)=>acc + p.preco * p.qtd, 0);
  // desktop
  const desktopConteudo = document.getElementById('carrinho-conteudo-desktop');
  desktopConteudo.innerHTML = '';
  carrinho.forEach((p,i) => {
    const subtotal = (p.preco * p.qtd).toFixed(2);
    const row = document.createElement('div');
    row.className = 'd-flex align-items-center justify-content-between mb-2';
    row.innerHTML = `
      <div style="flex:1">
        <div><strong>${p.nome}</strong></div>
        <div class="small text-muted">R$ ${p.preco.toFixed(2)} cada</div>
      </div>
      <div class="d-flex align-items-center gap-1">
        <button class="qty-btn btn btn-light btn-sm" onclick="changeQtyCart(${i}, -1)">-</button>
        <div class="px-2">${p.qtd}</div>
        <button class="qty-btn btn btn-light btn-sm" onclick="changeQtyCart(${i}, 1)">+</button>
        <div class="ms-2"><small>R$ ${subtotal}</small></div>
        <button class="btn btn-sm btn-link text-danger ms-2" onclick="removeItemCart(${i})"><i class="bi bi-trash"></i></button>
      </div>`;
    desktopConteudo.appendChild(row);
  });
  document.getElementById('total-compra-desktop').innerText = `R$ ${total.toFixed(2)}`;

  // mobile
  const mobileConteudo = document.getElementById('carrinho-conteudo-mobile');
  mobileConteudo.innerHTML = '';
  carrinho.forEach((p,i) => {
    const subtotal = (p.preco * p.qtd).toFixed(2);
    const item = document.createElement('div');
    item.className = 'd-flex align-items-center justify-content-between mb-2';
    item.innerHTML = `
      <div style="flex:1">
        <div><strong>${p.nome}</strong></div>
        <div class="small text-muted">R$ ${p.preco.toFixed(2)} cada</div>
      </div>
      <div class="d-flex align-items-center gap-1">
        <button class="qty-btn btn btn-light btn-sm" onclick="changeQtyCart(${i}, -1)">-</button>
        <div class="px-2">${p.qtd}</div>
        <button class="qty-btn btn btn-light btn-sm" onclick="changeQtyCart(${i}, 1)">+</button>
        <div class="ms-2"><small>R$ ${subtotal}</small></div>
        <button class="btn btn-sm btn-link text-danger ms-2" onclick="removeItemCart(${i})"><i class="bi bi-trash"></i></button>
      </div>`;
    mobileConteudo.appendChild(item);
  });
  document.getElementById('total-compra-mobile').innerText = `R$ ${total.toFixed(2)}`;

  // counters
  const count = carrinho.reduce((a,p)=>a+p.qtd,0);
  document.getElementById('cart-count').innerText = count;
  document.getElementById('cart-count-mobile').innerText = count;
  localStorage.setItem("carrinho_count", count);
}

/* ===========================
   Toggle Carrinho (desktop & mobile)
   =========================== */
function toggleCart() {
  const panel = document.getElementById('carrinho-desktop');
  panel.classList.toggle('ativo');
}
function fecharCarrinho(){
  const panel = document.getElementById('carrinho-desktop');
  panel.classList.remove('ativo');
  // scroll to products
  window.scrollTo({ top: document.querySelector('main').offsetTop, behavior:'smooth' });
}
function toggleCartMobile(){
  const panel = document.getElementById('carrinho-mobile-panel');
  panel.classList.toggle('ativo');
}

/* Mobile floating cart click opens mobile cart */
document.getElementById('cart-floating').addEventListener('click', () => toggleCartMobile());

/* Show floating cart icon on mobile when there are items or always (here always visible) */
function updateFloatingCartVisibility(){
  // show if mobile
  if (window.innerWidth <= 768){
    document.getElementById('cart-floating').style.display = 'flex';
  } else {
    document.getElementById('cart-floating').style.display = 'none';
  }
}

/* ===========================
   Search / Suggestion / Category load
   =========================== */
function searchTrigger(){
  // unified: use desktop input if visible else mobile
  const desktopVal = document.getElementById('search-input-desktop')?.value?.trim();
  const mobileVal = document.getElementById('search-input-mobile')?.value?.trim();
  const term = (desktopVal && desktopVal.length>0) ? desktopVal : mobileVal;
  filtrarProdutos(term || '');
}

function filtrarProdutos(term){
  term = (term || '').toLowerCase();
  const produtos = document.querySelectorAll('.produto');
  let anyMatch = false;
  if (!term){
    produtos.forEach(p=>p.style.display='block');
    document.getElementById('search-suggestions').innerHTML = '';
    return;
  }

  produtos.forEach(p=>{
    const nome = p.getAttribute('data-nome') || '';
    const cat = p.getAttribute('data-cat') || '';
    if (nome.includes(term) || cat.includes(term)){
      p.style.display='block';
      anyMatch = true;
    } else p.style.display='none';
  });

  // se n√£o encontrou nenhum produto, mostramos sugest√µes de categorias (chips)
  const suggestions = document.getElementById('search-suggestions');
  suggestions.innerHTML = '';
  if (!anyMatch){
    // mostrar categorias como chips
    const cats = Object.keys(categorias);
    cats.forEach(c => {
      const chip = document.createElement('span');
      chip.className = 'chip';
      chip.innerText = c.charAt(0).toUpperCase() + c.slice(1);
      chip.onclick = ()=>{ loadCategory(c); suggestions.innerHTML = ''; };
      suggestions.appendChild(chip);
    });
  }
}

/* Load only a single category (show section and scroll to it) */
function loadCategory(cat){
  // hide others
  ['lanches','bebidas','combos','ofertas'].forEach(s=>{
    const el = document.getElementById(s);
    if (s === cat) {
      el.style.display = 'flex';
      el.parentElement.querySelector('.categoria-titulo').style.display = 'block';
    } else {
      el.style.display = 'none';
      // hide title
      const titleId = 'title-' + s;
      const title = document.getElementById(titleId);
      if (title) title.style.display = 'none';
    }
  });
  // scroll to the chosen category
  const el = document.getElementById(cat);
  setTimeout(()=> el.scrollIntoView({behavior:'smooth'}), 80);
}

/* Show all categories again */
function showAll(){
  ['lanches','bebidas','combos','ofertas'].forEach(s=>{
    document.getElementById(s).style.display = 'flex';
    const title = document.getElementById('title-' + s);
    if (title) title.style.display = 'block';
  });
  window.scrollTo({ top: 0, behavior:'smooth' });
}

/* ===========================
   Checkout form (modal)
   =========================== */
const checkoutModal = new bootstrap.Modal(document.getElementById('checkoutModal'));

document.getElementById('btn-floating-action').addEventListener('click', () => {
  // If user hasn't scrolled fully to bottom, button floats (visible). Click -> open modal
  openCheckoutForm();
});

function openCheckoutForm(){
  if (carrinho.length === 0){
    swal("Carrinho vazio", "Adicione itens antes de finalizar o pedido.", "error");
    return;
  }
  document.getElementById('checkout-errors').style.display = 'none';
  checkoutModal.show();
}

/* Send order (open WhatsApp with formatted message) */
function sendOrder(){
  const nome = document.getElementById('cliente-nome').value.trim();
  const endereco = document.getElementById('cliente-endereco').value.trim();
  const pagamento = document.getElementById('cliente-pagamento').value;
  const obs = document.getElementById('cliente-obs').value.trim();

  if (!nome || !endereco || !pagamento){
    const err = document.getElementById('checkout-errors');
    err.innerText = 'Preencha nome, endere√ßo e forma de pagamento.';
    err.style.display = 'block';
    return;
  }

  // monta mensagem
  let msg = `üì¶ *Novo Pedido*\n\nCliente: ${nome}\nEndere√ßo: ${endereco}\nPagamento: ${pagamento}\nObs: ${obs || '-'}\n\nItens:\n`;
  const total = carrinho.reduce((acc,p)=>acc + p.preco * p.qtd,0);
  carrinho.forEach(i => { msg += `${i.qtd}x ${i.nome} - R$ ${(i.preco * i.qtd).toFixed(2)}\n`; });
  msg += `\nüí∞ Total: R$ ${total.toFixed(2)}`;

  const encoded = encodeURIComponent(msg);
  // abra WhatsApp (substitua o n√∫mero abaixo pelo seu)
  window.open(`https://wa.me/5531995847007?text=${encoded}`, '_blank');

  // limpar carrinho e UI
  carrinho = [];
  saveCart();
  updateCartUI();
  checkoutModal.hide();
  swal("Pedido enviado!", "Mensagem aberta no WhatsApp.", "success");
}

/* ===========================
   Floating action visibility by scroll
   =========================== */
function checkFloatingButton(){
  const btn = document.getElementById('btn-floating-action');
  const scrolledToBottom = (window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 10);
  if (scrolledToBottom) btn.classList.add('hidden');
  else btn.classList.remove('hidden');
}

/* ===========================
   Init
   =========================== */
window.addEventListener('load', () => {
  renderAll();
  updateFloatingCartVisibility();
  checkFloatingButton();
});

window.addEventListener('resize', () => {
  updateFloatingCartVisibility();
});

window.addEventListener('scroll', () => {
  checkFloatingButton();
});

/* Optional: allow Enter key in mobile/desktop search */
document.getElementById('search-input-desktop').addEventListener('keydown', e => { if (e.key==='Enter'){ e.preventDefault(); searchTrigger(); }});
document.getElementById('search-input-mobile').addEventListener('keydown', e => { if (e.key==='Enter'){ e.preventDefault(); searchTrigger(); }});
  </script>
</body>
</html>
